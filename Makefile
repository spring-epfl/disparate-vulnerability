DATA_PATH = data
TEXAS_PATH = ${DATA_PATH}/texas

${TEXAS_PATH}/PUDF_base1_%q2013_tab.zip:
	@echo "By downloading the dataset you agree with its usage conditions: https://www.dshs.texas.gov/THCIC/Hospitals/Download.shtm"
	curl -G "https://www.dshs.texas.gov/thcic/hospitals/Data/PUDF_base1_$*q2013_tab/" > $@

${TEXAS_PATH}/PUDF_base1_%q2013_tab.txt: ${TEXAS_PATH}/PUDF_base1_%q2013_tab.zip
	@unzip $< -d ${TEXAS_PATH}

texas: ${TEXAS_PATH}/PUDF_base1_1q2013_tab.txt \
	   ${TEXAS_PATH}/PUDF_base1_2q2013_tab.txt \
	   ${TEXAS_PATH}/PUDF_base1_3q2013_tab.txt \
	   ${TEXAS_PATH}/PUDF_base1_4q2013_tab.txt

data: texas

clean:
	rm -rf ${TEXAS_PATH}/*.zip

tests:
	NUM_SHADOWS=1 NUM_EVAL_MODELS=2 DATA_FILE_FORMAT="results/test_simulations_{}.csv" poetry run python simulations.py >/dev/null
	NUM_SHUFFLES=2 DATA_FILE_FORMAT="results/test_adult.csv" poetry run python adult.py >/dev/null
	NUM_SHUFFLES=2 DATA_FILE_FORMAT="results/test_texas.csv" poetry run python texas.py >/dev/null
	NUM_SHUFFLES=2 poetry run python reproducing_chang.py >/dev/null

.PHONY: data clean tests
